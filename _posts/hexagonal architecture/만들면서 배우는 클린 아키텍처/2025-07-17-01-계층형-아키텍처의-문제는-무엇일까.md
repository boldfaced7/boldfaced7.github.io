---
layout: single
title: '1. 계층형 아키텍처의 문제는 무엇일까?'
categories: [Hexagonal Architecture, 만들면서 배우는 클린 아키텍처]
tags: [Hexagonal Architecture, Clean Architecture]
toc: true
toc_sticky: true
---



# 1. 데이터베이스 주도 설계를 유도

## 데이터베이스가 토대가 되는 구조

- 계층형 아키텍처에서 웹은 도메인, 도메인은 영속성 계층에 의존하므로, 그 토대를 데이터베이스에 둠
  ![ur24qazd.png](/assets/images/hexagonal architecture/만들면서 배우는 클린 아키텍처/01-계층형-아키텍처의-문제는-무엇일까/ur24qazd.png)

- 따라서 의존성 방향 따라 데이터베이스 구조를 먼저 생각하고, 이를 토대로 도메인 로직 구현
  - 이 방식은 다양한 이유로 문제를 초래

## 애플리케이션: 상태 아닌 행동 중심

- 그런데 애플리케이션은 상태가 아니라 상태를 바꾸는 주체인 행동을 중심으로 모델링됨
- 그러므로 도메인 로직을 만들고, 해당 로직이 맞다는 것을 확인한 후에 영속성 계층과 웹 계층을 만들어야

## 문제: 영속성-도메인 사이 강한 결합

- 문제는 ORM과 계층형 아키텍처가 결합하면 영속성-도메인 계층 사이 강한 결합이 쉽게 발생한다는 것

  ![06w8le7z.png](/assets/images/hexagonal architecture/만들면서 배우는 클린 아키텍처/01-계층형-아키텍처의-문제는-무엇일까/06w8le7z.png)

  - ORM이 관리하는 엔티티는 일반적으로 영속성 계층에 위치하고, 도메인 계층이 엔티티에 접근
  - 서비스는 영속성 모델을 비즈니스 모델처럼 사용하게 되고, 이로 인해 영속성 계층과 관련된 작업을 해야

- 영속성 코드가 사실상 도메인 코드에 녹아들어가면, 둘 중 하나만 바꾸는 것이 어려워짐

# 2. 지름길을 택하기 쉬워짐

- 전통적 계층형 아키텍처에서는 같은 계층이거나, 아래 계층의 컴포넌트만 접근 가능한 것이 유일한 규칙
- 상위 계층 컴포넌트에 접근해야 하는 경우 컴포넌트를 계층 아래로 내리기도 해, 영속성 계층은 점점 비대해짐

  ![grj7nzcj.png](/assets/images/hexagonal architecture/만들면서 배우는 클린 아키텍처/01-계층형-아키텍처의-문제는-무엇일까/grj7nzcj.png)


# 3. 테스트하기 어려워짐

- 계층을 건너뛰어 웹에서 영속성 계층 컴포넌트를 호출하기도 해, 책임이 섞이고 테스트도 어려워짐

  ![1uu0nmvl.png](/assets/images/hexagonal architecture/만들면서 배우는 클린 아키텍처/01-계층형-아키텍처의-문제는-무엇일까/1uu0nmvl.png)

  - 웹 계층 테스트에서 영속성 계층도 모킹해야 해, 단위 테스트의 복잡도가 올라감

# 4. 유스케이스를 숨김

- 도메인 로직이 여러 계층에 흩어지기 쉬워, 기능을 추가하기 적당한 위치를 찾기가 어려움
- 시간이 지나면 여러 개의 유스케이스를 담당하는 아주 넓은 서비스가 만들어지기도

  ![h1u09yh6.png](/assets/images/hexagonal architecture/만들면서 배우는 클린 아키텍처/01-계층형-아키텍처의-문제는-무엇일까/h1u09yh6.png)

  - 작업해야 할 유스케이스를 책임지는 서비스를 찾기가 어려워짐

# 5. 동시 작업이 어려워짐

- 영속성 계층 위에 만들어지는 계층형 아키텍처는 영속성-도메인-웹 계층 순서로 만들어야 해, 특정 기능은 동시에 한 개발자만 작업 가능
  - 서로 다른 기능을 작업하기 위해 같은 서비스를 편집하다 병합 충돌이 발생하기도

- 구현체 없이 사전에 정의한 인터페이스만으로 작업하는 것은 데이터베이스 주도 설계를 하지 않는 경우에만 가능
  - 데이터베이스 주도 설계는 영속성 로직이 도메인 로직과 뒤섞여, 각 측면을 개별적으로 작업할 수 없음

# 6. 유지보수 가능한 소프트웨어를 만드는 데 어떻게 도움이 될까?

- 올바르게 구축하고 몇 가지 규칙을 추가로 적용한 계층형 아키텍처는 유지보수하기 쉬움
- 하지만 계층형 아키텍처는 많은 것들이 잘못된 방향으로 흘러가도록 용인해, 점점 유지보수가 어려워짐
- 계층형 아키텍처의 함정을 염두하면, 지름길을 택하지 않고 유지보수하기 더 쉬운 솔루션 만들기에 도움이 될 것

---

