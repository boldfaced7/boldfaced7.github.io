---
layout: single
title: "1. 프로듀서의 배치"
categories:
  - Kafka
  - 실전 카프카 개발부터 운영까지
  - 프로듀서의 내부 동작 원리와 구현
tags:
  - Kafka
  - 실전 카프카 개발부터 운영까지
  - 프로듀서의 내부 동작 원리와 구현
toc: true
toc_sticky: true
---
# 1. 배치란?

- 카프카는 배치 전송을 위해 버퍼에 파티션별로 레코드를 보관
    - 한 번에 다량의 메시지를 묶어 전송해, 불필요한 I/O를 줄일 수 있음
    
    ![20241217_192230.png](/assets/images/Kafka/실전 카프카 개발부터 운영까지/프로듀서의 내부 동작 원리와 구현/09-프로듀서의 배치/20241217_192230.png)
    
- 배치 전송을 위한 옵션들의 기본값은 다음과 같음
    
    ```java
    buffer.memory=32MB # 버퍼 메모리 크기
    batch.size=16KB # 배치(레코드의 묶음) 크기
    linger.ms=0ms # 버퍼 대기 시간
    ```
    
    - 버퍼 메모리(`buffer.memory`) 크기가 배치(`batch.size`)의 크기보다 충분히 커야 효과적인 배치 전송이 가능
        - 최소한 ‘배치 크기 X 파티션 개수’만큼 버퍼 메모리가 확보되어야
        - 전송 실패 시 재시도를 고려한다면, 여유 버퍼 메모리가 더 필요

- 사용 목적에 따라 처리량을 높일지, 지연 시간을 줄일지 선택해야
    - 처리량을 높여야 하는 경우: 효율적인 배치 전송 필요
    - 지연 시간을 줄여야 하는 경우: 배치 전송 사용을 최소화

# 2. 압축

- 배치 전송에 압축 기능을 같이 사용해, 메시지를 더욱 효율적으로 전송할 수 있음
- 높은 압축률을 선호하는 경우: `gzip`, `zstd`
- 낮은 지연 시간을 선호하는 경우: `lz4`, `snappy`