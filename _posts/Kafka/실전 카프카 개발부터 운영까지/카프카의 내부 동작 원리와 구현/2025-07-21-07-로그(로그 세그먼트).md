---
layout: single
title: "3. 로그(로그 세그먼트)"
categories:
  - Kafka
  - 실전 카프카 개발부터 운영까지
  - 카프카의 내부 동작 원리와 구현
tags:
  - Kafka
  - 실전 카프카 개발부터 운영까지
  - 카프카의 내부 동작 원리와 구현
toc: true
toc_sticky: true
---
# 1. 로그 세그먼트란?

- 토픽으로 들어오는 메시지는 로그 세그먼트 파일에 저장됨
    - 메시지 + 메시지 메타데이터(키, 벨류, 오프셋, 크기 등) 정보가 브로커 로컬에 저장됨
    - 오프셋 시작 번호를 이용해 파일 이름을 생성

- 로그 세그먼트 최대 크기는 1GB로 설정됨
    - 최대 크기 도달 시, 해당 세그먼트 파일을 닫고, 새로운 세그먼트를 생성(롤링 전략)

- 로그 세그먼트 파일이 무한히 늘어날 경우를 대비해, 로그 세그먼트 관리 계획을 수립해야

# 2. 로그 세그먼트 삭제

- `server.properties` 설정
    
    ```java
    log.cleanup.policy=delete # 기본값
    ```
    

- 보관 시간, 세그먼트 파일 크기를 기준으로 로그 세그먼트를 삭제할 수 있음
- 일정 주기(기본값: 5분)를 간격으로 로그 세그먼트 파일을 체크하며 삭제 작업 수행

# 3. 로그 세그먼트 컴팩션

- 메시지의 키값을 기준으로 마지막 데이터만 보관해 컴팩션 수행
    - 장애 복구 시, 최신의 상태만 복구해, 빠른 장애 복구가 가능
    - 프로듀서의 메시지 전송 시 키는 필수가 아니지만, 컴팩션 기능 사용 시에는 필수
    
    ![20241217_192114.png](/assets/images/Kafka/실전 카프카 개발부터 운영까지/카프카의 내부 동작 원리와 구현/07-로그(로그 세그먼트)/20241217_192114.png)
    

- 키값 기준, 과거 정보는 중요하지 않고, 마지막 값만 필요한 경우에만 수행해야
    - 예) 사용자의 현재 구매 현황 상태를 보여주는 시스템
- 로그 컴팩션 작업 중, 브로커의 과도한 입출력 부하가 발생할 수 있어, 모니터링을 병행해야