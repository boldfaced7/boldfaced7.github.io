---
layout: single
title: "4. 읽기와 쓰기 분리: CQRS 패턴"
categories:
  - MSA
  - 도메인 주도 설계로 시작하는 마이크로서비스 개발
  - MSA 애플리케이션 패턴
tags:
  - MSA
  - CQRS
  - 명령조회분리
  - 이벤트주도아키텍처
toc: true
toc_sticky: true
---

# 1. 읽기와 쓰기 통합

- 서비스의 성능 향상을 위해 인스턴스를 스케일 아웃할 경우, 데이터 읽기/쓰기 작업 중 리소스 교착 상태가 발생할 수도
    
    ![2.42.png](/assets/images/MSA/도메인 주도 설계로 시작하는 마이크로서비스 개발/MSA 애플리케이션 패턴/04-읽기와-쓰기-분리-CQRS-패턴/2.42.png)
    

# 2. CQRS: 읽기와 쓰기 분리

- **CQRS**: Command Query Responsibility Segregation, 명령과 조회 책임의 분리
    - 일반적인 비즈니스 모델에서는 조회 요청이 입력, 수정, 삭제 요청보다 많음
    - 쓰기 전략과 조회 전략을 분리해, 쓰기 시스템 부하와 조회 대기 시간을 줄임
    
    ![2.43.png](/assets/images/MSA/도메인 주도 설계로 시작하는 마이크로서비스 개발/MSA 애플리케이션 패턴/04-읽기와-쓰기-분리-CQRS-패턴/2.43.png)
    

# **3. CQRS 사례**: CQRS와 EDA의 연계

- 마이크로서비스를 명령/조회 측면으로 나눔
    
    ![2.44.png](/assets/images/MSA/도메인 주도 설계로 시작하는 마이크로서비스 개발/MSA 애플리케이션 패턴/04-읽기와-쓰기-분리-CQRS-패턴/2.44.png)
    

## **명령 서비스**

- 입력, 수정, 삭제 처리를 수행
- 쓰기에 최적화된 관계형 데이터베이스를 사용
- 업무 규칙 표현에 좋은 Java 사용

## **조회 서비스**

- 조회 처리만 수행
- 조회 성능이 높은 NoSQL 데이터베이스를 사용
- 조회의 간단한 구현이 가능한 스크립트 기반의 Node.js 사용
- 조회 서비스는 사용량이 많으므로, 스케일 아웃해 인스턴스를 확보

## **이벤트 주도 아키텍처**

- 명령 서비스가 사용되면 조회 서비스와의 데이터 일관성이 깨짐
- 이벤트 주도 아키텍처를 사용해 데이터 일관성을 유지
    - 명령 서비스: 데이터를 쓰면서 저장 내역이 담긴 이벤트를 발행
    - 조회 서비스: 이벤트 데이터를 가져와 데이터를 최신 상태로 동기화

## **결과적 일관성**

- 어느 시점이 되면 결과적으로 명령/조회 서비스의 데이터가 일치하게 됨